<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Ultimate Duidoku</title>
		<link href="https://fonts.googleapis.com/css?family=UnifrakturMaguntia&display=swap" rel="stylesheet"> 
		<link href="https://fonts.googleapis.com/css?family=Vollkorn+SC&display=swap" rel="stylesheet"> 
		<style>
			p {
				font-family: 'Vollkorn SC', cursive;
				font-size: 20px;
			}
			
			h1 {
				font-family: 'Vollkorn SC', cursive;
				font-size: 50px;
			}

			h2 {
				font-family: 'Vollkorn SC', cursive;
				font-size: 35px;			
			}

			button {
				font-family: 'UnifrakturMaguntia', cursive;
			}

			div {
				align-content: center;
				text-align: center;
			}
			.button {
				background-color: white;
				color: black;
				padding: 10px 10px;
				text-align: center;
				box-shadow: 2px 2px;
				margin: 3px 1px;
				display: inline-block;
				font-size: 30px;
				width: 60px;
				height: 60px;
				max-width: 60px;
				max-height: 60px;
			}

			.button:hover {
				background-color: lightgrey;
			}

			.horiz-space {
				display: inline-block;
			}

			.popup {
				visibility: hidden;
				left: 0px;
				top: 0px;
				z-index: 1;
				display: inline-block;
				position: fixed;

				background-color: white;
				color: black;
				padding: 10px 10px;
				box-shadow: 2px 2px;
				margin: 3px 1px;
				font-size: 30px;
				width: 60px;
				height: 60px;
				max-width: 60px;
				max-height: 60px;
			}

			.bottom {
				background-color: white;
				color: black;
				padding: 10px 10px;
				text-align: center;
				box-shadow: 2px 2px;
				margin: 3px 1px;
				display: inline-block;
				font-size: 30px;
				width: 300px;
				height: 60px;
				max-width: 300px;
				max-height: 60px;
				font-family: 'Vollkorn SC', cursive;
				font-size: 30px;
			}

			#top-bar {
				position: fixed; 
				align-content: center;
				text-align: center; 
				width: 100%;
				top: 0%;
				background-color: white;
			}
		</style>
		<script>
			/* Element Modification */
			var show_popup = function(posx, posy) {
				elements = document.getElementsByClassName("popup");
				moves = valid_moves(y, x);
				console.log(moves);
				minx = posx - moves.length * 60 / 2
				if (minx < 0) minx = 0;
				var j = 0;
				for (var i = 0; i < elements.length; i++) {
					if (moves.includes(parseInt(elements[i].innerHTML))) {
						elements[i].style.visibility = "visible";
						elements[i].style.top = posy + "px";
						elements[i].style.left = minx + j * 60 + "px";
						j++;
					}
				}
			}

			var show_grid = function() {
				elements = document.getElementsByClassName("button");
				for (var i = 0; i < elements.length; i++) {
					elements[i].style.color = "black";
				}
			}

			var hide_grid = function() {
				elements = document.getElementsByClassName("button");
				for (var i = 0; i < elements.length; i++) {
					elements[i].style.color = "lightgrey";
				}
			}

			var hide_popup = function() {
				elements = document.getElementsByClassName("popup");
				for (var i = 0; i < elements.length; i++) {
					elements[i].style.visibility = "hidden";
				}
			}

			var copy_board_to_window = function() {
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 9; j++) {
						if (board[i][j] === 0) {
							document.getElementById(i + "," + j).innerHTML = "&nbsp;";
						} else {
							document.getElementById(i + "," + j).innerHTML = board[i][j];
						}
					}
				}
			}

			var copy_board_copy_to_window = function() {
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 9; j++) {
						if (board_copy[i][j] === 0) {
							document.getElementById(i + "," + j).innerHTML = "&nbsp;";
						} else {
							document.getElementById(i + "," + j).innerHTML = board_copy[i][j];
						}
					}
				}
			}

			/* Board Code */
			var alloc_arr = function(r, c) {
				var arr = []
				for (var i = 0; i < r; i++) {
					var arri = []
					for (var j = 0; j < c; j++) {
						arri.push(0)
					}
					arr.push(arri)
				}
				
				return arr;
			}

			var copy_board = function() {
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 9; j++) {
						board_copy[i][j] = board[i][j];
					}
				}
			}

			var is_valid_move = function(r, c, v) {
				if (board[r][c] != 0) {
					return false;
    				}

				for (var i = 0; i < 9; i++) {
					if (board[r][i] == v) return false;
				}

				for (var i = 0; i < 9; i++) {
					if (board[i][c] == v) return false;
				}

				for (var i = Math.floor(r / 3) * 3; i < Math.floor(r / 3) * 3 + 3; i++) {
					for (var j = Math.floor(c / 3) * 3; j < Math.floor(c / 3) * 3 + 3; j++) {
						if (board[i][j] == v) return false;
					}
				}
				
				return true;
			}

			var valid_moves = function(r, c) {
				moves = [];
				for (var i = 1; i < 10; i++) {
					if (is_valid_move(r, c, i)) {
						moves.push(i);
					}
				}
				return moves;				
			}

			var is_valid_copy_move = function(r, c, v) {
				if (board_copy[r][c] != 0) {
					console.log("filled!");
					return false;
    				}

				for (var i = 0; i < 9; i++) {
					if (board_copy[r][i] == v) return false;
				}

				for (var i = 0; i < 9; i++) {
					if (board_copy[i][c] == v) return false;
				}

				for (var i = Math.floor(r / 3) * 3; i < Math.floor(r / 3) * 3 + 3; i++) {
					for (var j = Math.floor(c / 3) * 3; j < Math.floor(c / 3) * 3 + 3; j++) {
						if (board_copy[i][j] == v) return false;
					}
				}
				
				return true;
			}

			var nx = -1;
			var ny = -1;
			var next_empty = function() {
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 9; j++) {
						if (board_copy[i][j] == 0) {
							nx = j;
							ny = i;
							return true;
						}
					}
				}

				return false;
			}

			var solveable_r = function() {
				if (!next_empty()) {
					return true;
				}

				var vx = nx;
				var vy = ny;

				for (var k = 1; k <= 9; k++) {
					if (is_valid_copy_move(vy, vx, k)) {
						board_copy[vy][vx] = k;

						if (solveable_r()) 
							return true;

						board_copy[vy][vx] = 0;
					}
				}

				board[vy][vx] = 0;

				return false;
			}

			var solveable = function() {
				for (var i = 0; i < 9; i++) {
					for (var j = 0; j < 9; j++) {
						if (board[i][j] == 0 && valid_moves(i, j).length == 0)
							return false;
					}
				}

				return solveable_r();
			}

			var board = alloc_arr(9,9);
			var board_copy = alloc_arr(9,9);
			
			/* UI Code */
			var turn_number = 0;
			var entering = false;
			var x = -1;
			var y = -1;
			var disp = function(a,b) {
				if (!entering && board[a][b] == 0) {
					var dim = document.getElementById(a + "," + b).getBoundingClientRect();
					entering = true;
					y = a;
					x = b;
					show_popup(dim.left, dim.top);
					hide_grid();
				}
 			}

			var process = function(v) {
				board[y][x] = v;
				turn_number++;
				copy_board();

				var victor_box = document.getElementById("victor");

				if(!next_empty()) {
					victor_box.innerHTML = "The game is a tie!"
				} else if (!solveable()) {
					if (turn_number % 2 == 0) {
						victor_box.innerHTML = "Player 1 wins";
					} else {
						victor_box.innerHTML = "Player 2 wins";
					}
				} else {
					entering = false;
					show_grid();
				}
				copy_board_to_window();
				hide_popup();
			}

			var solved = false;
			var toggle_solve = function() {
				if (!solved && !entering) {
					copy_board();
					if(solveable()) {
						copy_board_copy_to_window();
						solved = true;
						entering = true;
						hide_grid();
						document.getElementById("solve-button").innerHTML = "Unsolve";
					}
				} else if (solved) {
					copy_board_to_window();
					solved = false;
					entering = false;
					show_grid();
					document.getElementById("solve-button").innerHTML = "Solve";
				}
			}
		</script>
	</head>
	<body>
		<br><br><br><br><br><br><br>
		<div>
			<h2>Rules</h2>
			<p>1. Squares are valid as in Sudoku<br>2. Moves alternate from Player 1 to Player 2<br>3. If your move causes an unsolvable board, you lose<br>4. If the board is solved, it is a tie</p> 
		</div>
		<br>
		<hr>
		<br><br>
		<div>
			<button class="button" id="0,0" onclick="disp(0,0)">&nbsp;</button>
			<button class="button" id="0,1" onclick="disp(0,1)">&nbsp;</button>
			<button class="button" id="0,2" onclick="disp(0,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="0,3" onclick="disp(0,3)">&nbsp;</button>
			<button class="button" id="0,4" onclick="disp(0,4)">&nbsp;</button>
			<button class="button" id="0,5" onclick="disp(0,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="0,6" onclick="disp(0,6)">&nbsp;</button>
			<button class="button" id="0,7" onclick="disp(0,7)">&nbsp;</button>
			<button class="button" id="0,8" onclick="disp(0,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="1,0" onclick="disp(1,0)">&nbsp;</button>
			<button class="button" id="1,1" onclick="disp(1,1)">&nbsp;</button>
			<button class="button" id="1,2" onclick="disp(1,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="1,3" onclick="disp(1,3)">&nbsp;</button>
			<button class="button" id="1,4" onclick="disp(1,4)">&nbsp;</button>
			<button class="button" id="1,5" onclick="disp(1,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="1,6" onclick="disp(1,6)">&nbsp;</button>
			<button class="button" id="1,7" onclick="disp(1,7)">&nbsp;</button>
			<button class="button" id="1,8" onclick="disp(1,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="2,0" onclick="disp(2,0)">&nbsp;</button>
			<button class="button" id="2,1" onclick="disp(2,1)">&nbsp;</button>
			<button class="button" id="2,2" onclick="disp(2,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="2,3" onclick="disp(2,3)">&nbsp;</button>
			<button class="button" id="2,4" onclick="disp(2,4)">&nbsp;</button>
			<button class="button" id="2,5" onclick="disp(2,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="2,6" onclick="disp(2,6)">&nbsp;</button>
			<button class="button" id="2,7" onclick="disp(2,7)">&nbsp;</button>
			<button class="button" id="2,8" onclick="disp(2,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			</div>
			<div>
			<br>
			<button class="button" id="3,0" onclick="disp(3,0)">&nbsp;</button>
			<button class="button" id="3,1" onclick="disp(3,1)">&nbsp;</button>
			<button class="button" id="3,2" onclick="disp(3,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="3,3" onclick="disp(3,3)">&nbsp;</button>
			<button class="button" id="3,4" onclick="disp(3,4)">&nbsp;</button>
			<button class="button" id="3,5" onclick="disp(3,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="3,6" onclick="disp(3,6)">&nbsp;</button>
			<button class="button" id="3,7" onclick="disp(3,7)">&nbsp;</button>
			<button class="button" id="3,8" onclick="disp(3,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="4,0" onclick="disp(4,0)">&nbsp;</button>
			<button class="button" id="4,1" onclick="disp(4,1)">&nbsp;</button>
			<button class="button" id="4,2" onclick="disp(4,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="4,3" onclick="disp(4,3)">&nbsp;</button>
			<button class="button" id="4,4" onclick="disp(4,4)">&nbsp;</button>
			<button class="button" id="4,5" onclick="disp(4,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="4,6" onclick="disp(4,6)">&nbsp;</button>
			<button class="button" id="4,7" onclick="disp(4,7)">&nbsp;</button>
			<button class="button" id="4,8" onclick="disp(4,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="5,0" onclick="disp(5,0)">&nbsp;</button>
			<button class="button" id="5,1" onclick="disp(5,1)">&nbsp;</button>
			<button class="button" id="5,2" onclick="disp(5,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="5,3" onclick="disp(5,3)">&nbsp;</button>
			<button class="button" id="5,4" onclick="disp(5,4)">&nbsp;</button>
			<button class="button" id="5,5" onclick="disp(5,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="5,6" onclick="disp(5,6)">&nbsp;</button>
			<button class="button" id="5,7" onclick="disp(5,7)">&nbsp;</button>
			<button class="button" id="5,8" onclick="disp(5,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			</div>
			<div>
			<br>
			<button class="button" id="6,0" onclick="disp(6,0)">&nbsp;</button>
			<button class="button" id="6,1" onclick="disp(6,1)">&nbsp;</button>
			<button class="button" id="6,2" onclick="disp(6,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="6,3" onclick="disp(6,3)">&nbsp;</button>
			<button class="button" id="6,4" onclick="disp(6,4)">&nbsp;</button>
			<button class="button" id="6,5" onclick="disp(6,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="6,6" onclick="disp(6,6)">&nbsp;</button>
			<button class="button" id="6,7" onclick="disp(6,7)">&nbsp;</button>
			<button class="button" id="6,8" onclick="disp(6,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="7,0" onclick="disp(7,0)">&nbsp;</button>
			<button class="button" id="7,1" onclick="disp(7,1)">&nbsp;</button>
			<button class="button" id="7,2" onclick="disp(7,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="7,3" onclick="disp(7,3)">&nbsp;</button>
			<button class="button" id="7,4" onclick="disp(7,4)">&nbsp;</button>
			<button class="button" id="7,5" onclick="disp(7,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="7,6" onclick="disp(7,6)">&nbsp;</button>
			<button class="button" id="7,7" onclick="disp(7,7)">&nbsp;</button>
			<button class="button" id="7,8" onclick="disp(7,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
			<button class="button" id="8,0" onclick="disp(8,0)">&nbsp;</button>
			<button class="button" id="8,1" onclick="disp(8,1)">&nbsp;</button>
			<button class="button" id="8,2" onclick="disp(8,2)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="8,3" onclick="disp(8,3)">&nbsp;</button>
			<button class="button" id="8,4" onclick="disp(8,4)">&nbsp;</button>
			<button class="button" id="8,5" onclick="disp(8,5)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<button class="button" id="8,6" onclick="disp(8,6)">&nbsp;</button>
			<button class="button" id="8,7" onclick="disp(8,7)">&nbsp;</button>
			<button class="button" id="8,8" onclick="disp(8,8)">&nbsp;</button>
			<p class = "horiz-space">&nbsp;&nbsp;</p>
			<br>
		</div>
		<br>
		</div>
		<div>
			<h2 id="victor"></h2>
		</div>
		<div>
			<button class="bottom" onclick="window.location.reload()">Restart</button>
			<button class="bottom" id="solve-button" onclick="toggle_solve()">Solve</button>
			<br><br><br>
			<hr>
		<div>
			<br><br>
			<p><b>Additional Information:</b></p>
			<p>Clicking solve will display current board's solution,<br>but will not end the game!</p>
			<br>
			<p>Concept: <a href="http://kaushikbasu.org/">Kaushik Basu</a><p>
			<p>&nbsp;Author: <a href="https://github.com/khemritolya">Luis Hoderlein</a></p>
		</div>
		<br>
		<div>
			<button class="popup" id="1" onclick="process(1)">1</button>
			<button class="popup" id="2" onclick="process(2)">2</button>
			<button class="popup" id="3" onclick="process(3)">3</button>
			<button class="popup" id="4" onclick="process(4)">4</button>
			<button class="popup" id="5" onclick="process(5)">5</button>
			<button class="popup" id="6" onclick="process(6)">6</button>
			<button class="popup" id="7" onclick="process(7)">7</button>
			<button class="popup" id="8" onclick="process(8)">8</button>
			<button class="popup" id="9" onclick="process(9)">9</button>
		</div>
		<div id="top-bar">
			<h1>Ultimate Duidoku</h1>
			<hr>
		</div>	
	</body>
</html>
